# Pathä¹‹ç©å‡ºèŠ±æ ·(PathMeasure)

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç»è¿‡ 
[Pathä¹‹åŸºæœ¬æ“ä½œ](http://www.gcssloop.com/customview/Path_Basic/)
[Pathä¹‹è´å¡å°”æ›²çº¿](http://www.gcssloop.com/customview/Path_Bezier/) å’Œ 
[Pathä¹‹å®Œç»“ç¯‡](http://www.gcssloop.com/customview/Path_Over/) åï¼Œ Pathä¸­å„ç±»æ–¹æ³•åŸºæœ¬ä¸Šéƒ½è®²å®Œäº†ï¼Œè¡¨æ ¼ä¸­è¿˜æ²¡æœ‰è®²è§£åˆ°åˆ°æ–¹æ³•å°±æ˜¯çŸ©é˜µå˜æ¢äº†ï¼Œéš¾é“æœ¬ç¯‡ç»ˆäºè¦è®²çŸ©é˜µäº†ï¼Ÿ
éä¹Ÿï¼ŒçŸ©é˜µè¿™ä¸€éƒ¨åˆ†ä»åœ¨åé¢å•ç‹¬è®²è§£ï¼Œæœ¬ç¯‡ä¸»è¦è®²è§£ PathMeasure è¿™ä¸ªç±»ä¸ Path çš„ä¸€äº›ä½¿ç”¨æŠ€å·§ã€‚

> PSï¼šä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆä¸è®² PathEffectï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•åœ¨åé¢çš„Paintç³»åˆ—ä¸­ã€‚

å…ˆæ”¾ä¸€ä¸ªå›¾é•‡æ¥¼ï¼Œçœçš„ä¸‹é¢æ— èŠçš„å†…å®¹æŠŠä½ ä»¬éƒ½å“è·‘äº†Î£(ï¿£ã€‚ï¿£ï¾‰)ï¾‰

![](http://ww3.sinaimg.cn/large/005Xtdi2jw1f4fp2myqo4g308c05k75k.gif)

------

## Path & PathMeasure

é¡¾åæ€ä¹‰ï¼ŒPathMeasureæ˜¯ä¸€ä¸ªç”¨æ¥æµ‹é‡Pathçš„ç±»ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æ–¹æ³•:

### æ„é€ æ–¹æ³•

| æ–¹æ³•å                                      | é‡Šä¹‰                                       |
| ---------------------------------------- | ---------------------------------------- |
| PathMeasure()                            | åˆ›å»ºä¸€ä¸ªç©ºçš„PathMeasure                        |
| PathMeasure(Path path, boolean forceClosed) | åˆ›å»º PathMeasure å¹¶å…³è”ä¸€ä¸ªæŒ‡å®šçš„Path(Pathéœ€è¦å·²ç»åˆ›å»ºå®Œæˆ)ã€‚ |

### å…¬å…±æ–¹æ³•

| è¿”å›å€¼     | æ–¹æ³•å                                      | é‡Šä¹‰                   |
| ------- | ---------------------------------------- | -------------------- |
| void    | setPath(Path path, boolean forceClosed)  | å…³è”ä¸€ä¸ªPath             |
| boolean | isClosed()                               | æ˜¯å¦é—­åˆ                 |
| float   | getLength()                              | è·å–Pathçš„é•¿åº¦            |
| boolean | nextContour()                            | è·³è½¬åˆ°ä¸‹ä¸€ä¸ªè½®å»“             |
| boolean | getSegment(float startD, float stopD, Path dst, boolean startWithMoveTo) | æˆªå–ç‰‡æ®µ                 |
| boolean | getPosTan(float distance, float[] pos, float[] tan) | è·å–æŒ‡å®šé•¿åº¦çš„ä½ç½®åæ ‡åŠè¯¥ç‚¹åˆ‡çº¿å€¼    |
| boolean | getMatrix(float distance, Matrix matrix, int flags) | è·å–æŒ‡å®šé•¿åº¦çš„ä½ç½®åæ ‡åŠè¯¥ç‚¹Matrix |

PathMeasureçš„æ–¹æ³•ä¹Ÿä¸å¤šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€ä¸€çš„è®²è§£ä¸€ä¸‹ã€‚

------

### 1.æ„é€ å‡½æ•°

æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªã€‚

**æ— å‚æ„é€ å‡½æ•°ï¼š**

```java
  PathMeasure ()
```

ç”¨è¿™ä¸ªæ„é€ å‡½æ•°å¯åˆ›å»ºä¸€ä¸ªç©ºçš„ PathMeasureï¼Œä½†æ˜¯ä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆè°ƒç”¨ setPath æ–¹æ³•æ¥ä¸ Path è¿›è¡Œå…³è”ã€‚è¢«å…³è”çš„ Path å¿…é¡»æ˜¯å·²ç»åˆ›å»ºå¥½çš„ï¼Œå¦‚æœå…³è”ä¹‹å Path å†…å®¹è¿›è¡Œäº†æ›´æ”¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ setPath æ–¹æ³•é‡æ–°å…³è”ã€‚

**æœ‰å‚æ„é€ å‡½æ•°ï¼š**

```java
  PathMeasure (Path path, boolean forceClosed)
```

ç”¨è¿™ä¸ªæ„é€ å‡½æ•°æ˜¯åˆ›å»ºä¸€ä¸ª PathMeasure å¹¶å…³è”ä¸€ä¸ª Pathï¼Œ å…¶å®å’Œåˆ›å»ºä¸€ä¸ªç©ºçš„ PathMeasure åè°ƒç”¨ setPath è¿›è¡Œå…³è”æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·ï¼Œè¢«å…³è”çš„ Path ä¹Ÿå¿…é¡»æ˜¯å·²ç»åˆ›å»ºå¥½çš„ï¼Œå¦‚æœå…³è”ä¹‹å Path å†…å®¹è¿›è¡Œäº†æ›´æ”¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ setPath æ–¹æ³•é‡æ–°å…³è”ã€‚

è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è‡ªç„¶å°±æ˜¯è¢«å…³è”çš„ Path äº†ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥ç¡®ä¿ Path é—­åˆï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œ åˆ™ä¸è®ºä¹‹å‰Pathæ˜¯å¦é—­åˆï¼Œéƒ½ä¼šè‡ªåŠ¨é—­åˆè¯¥ Path(å¦‚æœPathå¯ä»¥é—­åˆçš„è¯)ã€‚

**åœ¨è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ˜ç¡®:**

> 

- 1. ä¸è®º forceClosed è®¾ç½®ä¸ºä½•ç§çŠ¶æ€(true æˆ–è€… false)ï¼Œ éƒ½ä¸ä¼šå½±å“åŸæœ‰Pathçš„çŠ¶æ€ï¼Œ**å³ Path ä¸ PathMeasure  å…³è”ä¹‹åï¼Œä¹‹å‰çš„çš„ Path ä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ã€‚**
- 1. forceClosed çš„è®¾ç½®çŠ¶æ€å¯èƒ½ä¼šå½±å“æµ‹é‡ç»“æœï¼Œ**å¦‚æœ Path æœªé—­åˆä½†åœ¨ä¸ PathMeasure å…³è”çš„æ—¶å€™è®¾ç½® forceClosed ä¸º true æ—¶ï¼Œæµ‹é‡ç»“æœå¯èƒ½ä¼šæ¯” Path å®é™…é•¿åº¦ç¨é•¿ä¸€ç‚¹ï¼Œè·å–åˆ°åˆ°æ˜¯è¯¥ Path é—­åˆæ—¶çš„çŠ¶æ€ã€‚**

ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥éªŒè¯ä¸€ä¸‹ï¼š

```java
canvas.translate(mViewWidth/2,mViewHeight/2);

Path path = new Path();

path.lineTo(0,200);
path.lineTo(200,200);
path.lineTo(200,0);

PathMeasure measure1 = new PathMeasure(path,false);
PathMeasure measure2 = new PathMeasure(path,true);

Log.e("TAG", "forceClosed=false---->"+measure1.getLength());
Log.e("TAG", "forceClosed=true----->"+measure2.getLength());

canvas.drawPath(path,mDeafultPaint);
```

logå¦‚ä¸‹:

```shell
com.gcssloop.canvas E/TAG: forceClosed=false---->600.0
com.gcssloop.canvas E/TAG: forceClosed=true----->800.0
```

ç»˜åˆ¶åœ¨ç•Œé¢ä¸Šçš„æ•ˆæœå¦‚ä¸‹:

![](http://ww4.sinaimg.cn/large/005Xtdi2jw1f49allf7gij308c0et3yk.jpg)

æˆ‘ä»¬æ‰€åˆ›å»ºçš„ Path å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¾¹é•¿ä¸º 200 çš„æ­£æ–¹å½¢çš„ä¸‰æ¡è¾¹ï¼Œé€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹å°±èƒ½éªŒè¯ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ã€‚

> 

- 1.æˆ‘ä»¬å°† Path ä¸ä¸¤ä¸ªçš„ PathMeasure è¿›è¡Œå…³è”ï¼Œå¹¶ç»™ forceClosed è®¾ç½®äº†ä¸åŒçš„çŠ¶æ€ï¼Œä¹‹åç»˜åˆ¶å†ç»˜åˆ¶å‡ºæ¥çš„ Path æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œæ‰€ä»¥ä¸ Path ä¸ PathMeasureè¿›è¡Œå…³è”å¹¶ä¸ä¼šå½±å“ Path çŠ¶æ€ã€‚
- 2.æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½® forceClosed ä¸º true çš„æ–¹æ³•æ¯”è®¾ç½®ä¸º false çš„æ–¹æ³•æµ‹é‡å‡ºæ¥çš„é•¿åº¦è¦é•¿ä¸€ç‚¹ï¼Œè¿™æ˜¯ç”±äº Path æ²¡æœ‰é—­åˆçš„ç¼˜æ•…ï¼Œå¤šå‡ºæ¥çš„è·ç¦»æ­£æ˜¯ Path æœ€åä¸€ä¸ªç‚¹ä¸æœ€å¼€å§‹ä¸€ä¸ªç‚¹ä¹‹é—´ç‚¹è·ç¦»ã€‚**forceClosed ä¸º false æµ‹é‡çš„æ˜¯å½“å‰ Path  çŠ¶æ€çš„é•¿åº¦ï¼Œ forceClosed ä¸º trueï¼Œåˆ™ä¸è®ºPathæ˜¯å¦é—­åˆæµ‹é‡çš„éƒ½æ˜¯ Path çš„é—­åˆé•¿åº¦ã€‚**



### 2.setPathã€ isClosed å’Œ getLength

è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½å¦‚å­—é¢æ„æ€ä¸€æ ·ï¼Œéå¸¸ç®€å•ï¼Œè¿™é‡Œå°±ç®€å•æ˜¯å™è¿°ä¸€ä¸‹ï¼Œä¸å†è¿‡å¤šè®²è§£ã€‚

setPath æ˜¯ PathMeasure ä¸ Path å…³è”çš„é‡è¦æ–¹æ³•ï¼Œæ•ˆæœå’Œ æ„é€ å‡½æ•° ä¸­ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚

isClosed ç”¨äºåˆ¤æ–­ Path æ˜¯å¦é—­åˆï¼Œä½†æ˜¯å¦‚æœä½ åœ¨å…³è” Path çš„æ—¶å€™è®¾ç½® forceClosed ä¸º true çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼åˆ™ä¸€å®šä¸ºtrueã€‚

getLength ç”¨äºè·å– Path çš„æ€»é•¿åº¦ï¼Œåœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­å·²ç»ç”¨è¿‡äº†ã€‚



### 3.getSegment

getSegment ç”¨äºè·å–Pathçš„ä¸€ä¸ªç‰‡æ®µï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š

```java
boolean getSegment (float startD, float stopD, Path dst, boolean startWithMoveTo)
```

æ–¹æ³•å„ä¸ªå‚æ•°é‡Šä¹‰ï¼š

| å‚æ•°              | ä½œç”¨                   | å¤‡æ³¨                                       |
| --------------- | -------------------- | ---------------------------------------- |
| è¿”å›å€¼(boolean)    | åˆ¤æ–­æˆªå–æ˜¯å¦æˆåŠŸ             | true è¡¨ç¤ºæˆªå–æˆåŠŸï¼Œç»“æœå­˜å…¥dstä¸­ï¼Œfalse æˆªå–å¤±è´¥ï¼Œä¸ä¼šæ”¹å˜dstä¸­å†…å®¹ |
| startD          | å¼€å§‹æˆªå–ä½ç½®è·ç¦» Path èµ·ç‚¹çš„é•¿åº¦  | å–å€¼èŒƒå›´: 0 <= startD < stopD <= Pathæ€»é•¿åº¦     |
| stopD           | ç»“æŸæˆªå–ä½ç½®è·ç¦» Path èµ·ç‚¹çš„é•¿åº¦  | å–å€¼èŒƒå›´: 0 <= startD < stopD <= Pathæ€»é•¿åº¦     |
| dst             | æˆªå–çš„ Path å°†ä¼šæ·»åŠ åˆ° dst ä¸­ | æ³¨æ„: æ˜¯æ·»åŠ ï¼Œè€Œä¸æ˜¯æ›¿æ¢                            |
| startWithMoveTo | èµ·å§‹ç‚¹æ˜¯å¦ä½¿ç”¨ moveTo       | ç”¨äºä¿è¯æˆªå–çš„ Path ç¬¬ä¸€ä¸ªç‚¹ä½ç½®ä¸å˜                    |

> 

- å¦‚æœ startDã€stopD çš„æ•°å€¼ä¸åœ¨å–å€¼èŒƒå›´ [0, getLength] å†…ï¼Œæˆ–è€… startD == stopD åˆ™è¿”å›å€¼ä¸º falseï¼Œä¸ä¼šæ”¹å˜ dst å†…å®¹ã€‚
- å¦‚æœåœ¨å®‰å“4.4æˆ–è€…ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåœ¨é»˜è®¤å¼€å¯ç¡¬ä»¶åŠ é€Ÿçš„æƒ…å†µä¸‹ï¼Œæ›´æ”¹ dst çš„å†…å®¹åå¯èƒ½ç»˜åˆ¶ä¼šå‡ºç°é—®é¢˜ï¼Œè¯·å…³é—­ç¡¬ä»¶åŠ é€Ÿæˆ–è€…ç»™ dst  æ·»åŠ ä¸€ä¸ªå•ä¸ªæ“ä½œï¼Œä¾‹å¦‚: dst.rLineTo(0, 0)

æˆ‘ä»¬å…ˆçœ‹çœ‹è¿™ä¸ªæ–¹æ³•å¦‚ä½•ä½¿ç”¨ï¼š

æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Pathï¼Œ å¹¶åœ¨å…¶ä¸­æ·»åŠ äº†ä¸€ä¸ªçŸ©å½¢ï¼Œç°åœ¨æˆ‘ä»¬æƒ³æˆªå–çŸ©å½¢ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­çº¢è‰²çš„éƒ¨åˆ†ã€‚

> çŸ©å½¢è¾¹é•¿400dpï¼Œèµ·å§‹ç‚¹åœ¨å·¦ä¸Šè§’ï¼Œé¡ºæ—¶é’ˆ

![](http://ww2.sinaimg.cn/large/005Xtdi2jw1f4bohcxzhqj308c0etwej.jpg)

ä»£ç :

```java
canvas.translate(mViewWidth / 2, mViewHeight / 2);          // å¹³ç§»åæ ‡ç³»

Path path = new Path();                                     // åˆ›å»ºPathå¹¶æ·»åŠ äº†ä¸€ä¸ªçŸ©å½¢
path.addRect(-200, -200, 200, 200, Path.Direction.CW);

Path dst = new Path();                                      // åˆ›å»ºç”¨äºå­˜å‚¨æˆªå–åå†…å®¹çš„ Path

PathMeasure measure = new PathMeasure(path, false);         // å°† Path ä¸ PathMeasure å…³è”

// æˆªå–ä¸€éƒ¨åˆ†å­˜å…¥dstä¸­ï¼Œå¹¶ä½¿ç”¨ moveTo ä¿æŒæˆªå–å¾—åˆ°çš„ Path ç¬¬ä¸€ä¸ªç‚¹çš„ä½ç½®ä¸å˜
measure.getSegment(200, 600, dst, true);                    

canvas.drawPath(dst, mDeafultPaint);                        // ç»˜åˆ¶ dst
```

ç»“æœå¦‚ä¸‹ï¼š

![](http://ww2.sinaimg.cn/large/005Xtdi2jw1f4bpmetj7wj308c0etdfu.jpg)

ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸåˆ°å°†éœ€è¦åˆ°ç‰‡æ®µæˆªå–äº†å‡ºæ¥ï¼Œç„¶è€Œå½“ dst ä¸­æœ‰å†…å®¹æ—¶ä¼šæ€æ ·å‘¢ï¼Ÿ

```java
canvas.translate(mViewWidth / 2, mViewHeight / 2);          // å¹³ç§»åæ ‡ç³»

Path path = new Path();                                     // åˆ›å»ºPathå¹¶æ·»åŠ äº†ä¸€ä¸ªçŸ©å½¢
path.addRect(-200, -200, 200, 200, Path.Direction.CW);

Path dst = new Path();                                      // åˆ›å»ºç”¨äºå­˜å‚¨æˆªå–åå†…å®¹çš„ Path
dst.lineTo(-300, -300);                                     // <--- åœ¨ dst ä¸­æ·»åŠ ä¸€æ¡çº¿æ®µ

PathMeasure measure = new PathMeasure(path, false);         // å°† Path ä¸ PathMeasure å…³è”

measure.getSegment(200, 600, dst, true);                   // æˆªå–ä¸€éƒ¨åˆ† å¹¶ä½¿ç”¨ moveTo ä¿æŒæˆªå–å¾—åˆ°çš„ Path ç¬¬ä¸€ä¸ªç‚¹çš„ä½ç½®ä¸å˜

canvas.drawPath(dst, mDeafultPaint);                        // ç»˜åˆ¶ Path
```

ç»“æœå¦‚ä¸‹:

![](http://ww3.sinaimg.cn/large/005Xtdi2gw1f4cg8rl0wmj308c0et74b.jpg)

ä»ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥çœ‹åˆ° dst ä¸­çš„çº¿æ®µä¿ç•™äº†ä¸‹æ¥ï¼Œå¯ä»¥å¾—åˆ°ç»“è®ºï¼š**è¢«æˆªå–çš„ Path ç‰‡æ®µä¼šæ·»åŠ åˆ° dst ä¸­ï¼Œè€Œä¸æ˜¯æ›¿æ¢ dst ä¸­åˆ°å†…å®¹ã€‚**

å‰é¢ä¸¤ä¸ªä¾‹å­ä¸­ startWithMoveTo å‡ä¸º trueï¼Œ å¦‚æœè®¾ç½®ä¸ºfalseä¼šæ€æ ·å‘¢?

```java
canvas.translate(mViewWidth / 2, mViewHeight / 2);          // å¹³ç§»åæ ‡ç³»

Path path = new Path();                                     // åˆ›å»ºPathå¹¶æ·»åŠ äº†ä¸€ä¸ªçŸ©å½¢
path.addRect(-200, -200, 200, 200, Path.Direction.CW);

Path dst = new Path();                                      // åˆ›å»ºç”¨äºå­˜å‚¨æˆªå–åå†…å®¹çš„ Path
dst.lineTo(-300, -300);                                     // åœ¨ dst ä¸­æ·»åŠ ä¸€æ¡çº¿æ®µ

PathMeasure measure = new PathMeasure(path, false);         // å°† Path ä¸ PathMeasure å…³è”

measure.getSegment(200, 600, dst, false);                   // <--- æˆªå–ä¸€éƒ¨åˆ† ä¸ä½¿ç”¨ startMoveTo, ä¿æŒ dst çš„è¿ç»­æ€§

canvas.drawPath(dst, mDeafultPaint);                        // ç»˜åˆ¶ Path
```

ç»“æœå¦‚ä¸‹ï¼š

![](http://ww2.sinaimg.cn/large/005Xtdi2gw1f4cgdgc7etj308c0et3yk.jpg)

ä»è¯¥ç¤ºä¾‹æˆ‘ä»¬åˆå¯ä»¥å¾—åˆ°ä¸€æ¡ç»“è®ºï¼š**å¦‚æœ startWithMoveTo ä¸º true, åˆ™è¢«æˆªå–å‡ºæ¥åˆ°Pathç‰‡æ®µä¿æŒåŸçŠ¶ï¼Œå¦‚æœ startWithMoveTo ä¸º falseï¼Œåˆ™ä¼šå°†æˆªå–å‡ºæ¥çš„ Path ç‰‡æ®µçš„èµ·å§‹ç‚¹ç§»åŠ¨åˆ° dst çš„æœ€åä¸€ä¸ªç‚¹ï¼Œä»¥ä¿è¯ dst çš„è¿ç»­æ€§ã€‚**

ä»è€Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹è§„åˆ™æ¥åˆ¤æ–­ startWithMoveTo çš„å–å€¼ï¼š

| å–å€¼    | ä¸»è¦åŠŸç”¨                     |
| ----- | ------------------------ |
| true  | ä¿è¯æˆªå–å¾—åˆ°çš„ Path ç‰‡æ®µä¸ä¼šå‘ç”Ÿå½¢å˜    |
| false | ä¿è¯å­˜å‚¨æˆªå–ç‰‡æ®µçš„ Path(dst) çš„è¿ç»­æ€§ |



### 4.nextContour

æˆ‘ä»¬çŸ¥é“ Path å¯ä»¥ç”±å¤šæ¡æ›²çº¿æ„æˆï¼Œä½†ä¸è®ºæ˜¯ getLength , getSegment æˆ–è€…æ˜¯å…¶å®ƒæ–¹æ³•ï¼Œéƒ½åªä¼šåœ¨å…¶ä¸­ç¬¬ä¸€æ¡çº¿æ®µä¸Šè¿è¡Œï¼Œè€Œè¿™ä¸ª `nextContour` å°±æ˜¯ç”¨äºè·³è½¬åˆ°ä¸‹ä¸€æ¡æ›²çº¿åˆ°æ–¹æ³•ï¼Œ_å¦‚æœè·³è½¬æˆåŠŸï¼Œåˆ™è¿”å› trueï¼Œ å¦‚æœè·³è½¬å¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚_

å¦‚ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Path å¹¶ä½¿å…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªé—­åˆçš„æ›²çº¿ï¼Œå†…éƒ¨çš„è¾¹é•¿æ˜¯200ï¼Œå¤–é¢çš„è¾¹é•¿æ˜¯400ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨ PathMeasure åˆ†åˆ«æµ‹é‡ä¸¤æ¡æ›²çº¿çš„æ€»é•¿åº¦ã€‚

![](http://ww2.sinaimg.cn/large/005Xtdi2jw1f4ctzjr08dj308c0et74c.jpg)

ä»£ç ï¼š

```java
canvas.translate(mViewWidth / 2, mViewHeight / 2);      // å¹³ç§»åæ ‡ç³»

Path path = new Path();

path.addRect(-100, -100, 100, 100, Path.Direction.CW);  // æ·»åŠ å°çŸ©å½¢
path.addRect(-200, -200, 200, 200, Path.Direction.CW);  // æ·»åŠ å¤§çŸ©å½¢

canvas.drawPath(path,mDeafultPaint);                    // ç»˜åˆ¶ Path

PathMeasure measure = new PathMeasure(path, false);     // å°†Pathä¸PathMeasureå…³è”

float len1 = measure.getLength();                       // è·å¾—ç¬¬ä¸€æ¡è·¯å¾„çš„é•¿åº¦

measure.nextContour();                                  // è·³è½¬åˆ°ä¸‹ä¸€æ¡è·¯å¾„

float len2 = measure.getLength();                       // è·å¾—ç¬¬äºŒæ¡è·¯å¾„çš„é•¿åº¦

Log.i("LEN","len1="+len1);                              // è¾“å‡ºä¸¤æ¡è·¯å¾„çš„é•¿åº¦
Log.i("LEN","len2="+len2);
```

logè¾“å‡ºç»“æœ:

```shell
com.gcssloop.canvas I/LEN: len1=800.0
com.gcssloop.canvas I/LEN: len2=1600.0
```

é€šè¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š

- 1.æ›²çº¿çš„é¡ºåºä¸ Path ä¸­æ·»åŠ çš„é¡ºåºæœ‰å…³ã€‚
- 2.getLength è·å–åˆ°åˆ°æ˜¯å½“å‰ä¸€æ¡æ›²çº¿åˆ†é•¿åº¦ï¼Œè€Œä¸æ˜¯æ•´ä¸ª Path çš„é•¿åº¦ã€‚
- 3.getLength ç­‰æ–¹æ³•æ˜¯é’ˆå¯¹å½“å‰çš„æ›²çº¿(å…¶å®ƒæ–¹æ³•è¯·è‡ªè¡ŒéªŒè¯)ã€‚

#### 5.getPosTan

è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºå¾—åˆ°è·¯å¾„ä¸ŠæŸä¸€é•¿åº¦çš„ä½ç½®ä»¥åŠè¯¥ä½ç½®çš„æ­£åˆ‡å€¼ï¼š

```java
boolean getPosTan (float distance, float[] pos, float[] tan)
```

æ–¹æ³•å„ä¸ªå‚æ•°é‡Šä¹‰ï¼š

| å‚æ•°           | ä½œç”¨            | å¤‡æ³¨                                       |
| ------------ | ------------- | ---------------------------------------- |
| è¿”å›å€¼(boolean) | åˆ¤æ–­è·å–æ˜¯å¦æˆåŠŸ      | trueè¡¨ç¤ºæˆåŠŸï¼Œæ•°æ®ä¼šå­˜å…¥ pos å’Œ tan ä¸­ï¼Œ<br/>false è¡¨ç¤ºå¤±è´¥ï¼Œpos å’Œ tan ä¸ä¼šæ”¹å˜ |
| distance     | è·ç¦» Path èµ·ç‚¹çš„é•¿åº¦ | å–å€¼èŒƒå›´: 0 <= distance <= getLength         |
| pos          | è¯¥ç‚¹çš„åæ ‡å€¼        | å½“å‰ç‚¹åœ¨ç”»å¸ƒä¸Šçš„ä½ç½®ï¼Œæœ‰ä¸¤ä¸ªæ•°å€¼ï¼Œåˆ†åˆ«ä¸ºxï¼Œyåæ ‡ã€‚               |
| tan          | è¯¥ç‚¹çš„æ­£åˆ‡å€¼        | å½“å‰ç‚¹åœ¨æ›²çº¿ä¸Šçš„æ–¹å‘ï¼Œä½¿ç”¨  Math.atan2(tan[1], tan[0]) è·å–åˆ°æ­£åˆ‡è§’çš„å¼§åº¦å€¼ã€‚ |

è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸éš¾ç†è§£ï¼Œé™¤äº†å…¶ä¸­ `tan` è¿™ä¸ªä¸œä¸œï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿ

`tan` æ˜¯ç”¨æ¥åˆ¤æ–­ Path ä¸Šè¶‹åŠ¿çš„ï¼Œå³åœ¨è¿™ä¸ªä½ç½®ä¸Šæ›²çº¿çš„èµ°å‘ï¼Œè¯·çœ‹ä¸‹å›¾ç¤ºä¾‹ï¼Œæ³¨æ„ç®­å¤´çš„æ–¹å‘:

![](http://ww4.sinaimg.cn/large/005Xtdi2jw1f4dtufydm4g308c0etmyl.gif)

**[ç‚¹å‡»è¿™é‡Œä¸‹è½½ç®­å¤´å›¾ç‰‡](http://ww1.sinaimg.cn/large/005Xtdi2jw1f4gam21ktoj3069069jre.jpg)**

å¯ä»¥çœ‹åˆ° ä¸Šå›¾ä¸­ç®­å¤´åœ¨æ²¿ç€ Path è¿åŠ¨æ—¶ï¼Œæ–¹å‘å§‹ç»ˆä¸ Path èµ°å‘ä¿æŒä¸€è‡´ï¼Œä¿æŒæ–¹å‘ä¸»è¦å°±æ˜¯ä¾é  `tan` ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç æ˜¯å¦‚ä½•å®ç°çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰å‡ ä¸ªå¿…è¦çš„å˜é‡:

```java
private float currentValue = 0;     // ç”¨äºçºªå½•å½“å‰çš„ä½ç½®,å–å€¼èŒƒå›´[0,1]æ˜ å°„Pathçš„æ•´ä¸ªé•¿åº¦

private float[] pos;                // å½“å‰ç‚¹çš„å®é™…ä½ç½®
private float[] tan;                // å½“å‰ç‚¹çš„tangentå€¼,ç”¨äºè®¡ç®—å›¾ç‰‡æ‰€éœ€æ—‹è½¬çš„è§’åº¦
private Bitmap mBitmap;             // ç®­å¤´å›¾ç‰‡
private Matrix mMatrix;             // çŸ©é˜µ,ç”¨äºå¯¹å›¾ç‰‡è¿›è¡Œä¸€äº›æ“ä½œ
```

åˆå§‹åŒ–è¿™äº›å˜é‡(åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•):

```java
private void init(Context context) {
    pos = new float[2];
    tan = new float[2];
    BitmapFactory.Options options = new BitmapFactory.Options();
    options.inSampleSize = 2;       // ç¼©æ”¾å›¾ç‰‡
    mBitmap = BitmapFactory.decodeResource(context.getResources(), R.drawable.arrow, options);
    mMatrix = new Matrix();
}
```

å…·ä½“ç»˜åˆ¶:

```java
canvas.translate(mViewWidth / 2, mViewHeight / 2);      // å¹³ç§»åæ ‡ç³»

Path path = new Path();                                 // åˆ›å»º Path

path.addCircle(0, 0, 200, Path.Direction.CW);           // æ·»åŠ ä¸€ä¸ªåœ†å½¢

PathMeasure measure = new PathMeasure(path, false);     // åˆ›å»º PathMeasure

currentValue += 0.005;                                  // è®¡ç®—å½“å‰çš„ä½ç½®åœ¨æ€»é•¿åº¦ä¸Šçš„æ¯”ä¾‹[0,1]
if (currentValue >= 1) {
  currentValue = 0;
}

measure.getPosTan(measure.getLength() * currentValue, pos, tan);        // è·å–å½“å‰ä½ç½®çš„åæ ‡ä»¥åŠè¶‹åŠ¿

mMatrix.reset();                                                        // é‡ç½®Matrix
float degrees = (float) (Math.atan2(tan[1], tan[0]) * 180.0 / Math.PI); // è®¡ç®—å›¾ç‰‡æ—‹è½¬è§’åº¦

mMatrix.postRotate(degrees, mBitmap.getWidth() / 2, mBitmap.getHeight() / 2);   // æ—‹è½¬å›¾ç‰‡
mMatrix.postTranslate(pos[0] - mBitmap.getWidth() / 2, pos[1] - mBitmap.getHeight() / 2);   // å°†å›¾ç‰‡ç»˜åˆ¶ä¸­å¿ƒè°ƒæ•´åˆ°ä¸å½“å‰ç‚¹é‡åˆ

canvas.drawPath(path, mDeafultPaint);                                   // ç»˜åˆ¶ Path
canvas.drawBitmap(mBitmap, mMatrix, mDeafultPaint);                     // ç»˜åˆ¶ç®­å¤´

invalidate();                                                           // é‡ç»˜é¡µé¢
```

**æ ¸å¿ƒè¦ç‚¹:**

> 

- 1.**é€šè¿‡ `tan` å¾—å€¼è®¡ç®—å‡ºå›¾ç‰‡æ—‹è½¬çš„è§’åº¦**ï¼Œtan æ˜¯ tangent çš„ç¼©å†™ï¼Œå³ä¸­å­¦ä¸­å¸¸è§çš„æ­£åˆ‡ï¼Œ å…¶ä¸­tan[0]æ˜¯é‚»è¾¹è¾¹é•¿ï¼Œtan[1]æ˜¯å¯¹è¾¹è¾¹é•¿ï¼Œè€ŒMathä¸­ `atan2` æ–¹æ³•æ˜¯æ ¹æ®æ­£åˆ‡æ˜¯æ•°å€¼è®¡ç®—å‡ºè¯¥è§’åº¦çš„å¤§å°,å¾—åˆ°çš„å•ä½æ˜¯å¼§åº¦(å–å€¼èŒƒå›´æ˜¯ -pi åˆ° pi)ï¼Œæ‰€ä»¥ä¸Šé¢åˆå°†å¼§åº¦è½¬ä¸ºäº†è§’åº¦ã€‚
- 2.**é€šè¿‡ `Matrix` æ¥è®¾ç½®å›¾ç‰‡å¯¹æ—‹è½¬è§’åº¦å’Œä½ç§»**ï¼Œè¿™é‡Œä½¿ç”¨çš„æ–¹æ³•ä¸å‰é¢è®²è§£è¿‡å¯¹ canvasæ“ä½œ æœ‰äº›ç±»ä¼¼ï¼Œå¯¹äº `Matrix` ä¼šåœ¨åé¢ä¸“ä¸€è¿›è¡Œè®²è§£ï¼Œæ•¬è¯·æœŸå¾…ã€‚
- 3.**é¡µé¢åˆ·æ–°**ï¼Œé¡µé¢åˆ·æ–°æ­¤å¤„æ˜¯åœ¨ onDraw é‡Œé¢è°ƒç”¨äº† invalidate æ–¹æ³•æ¥ä¿æŒç•Œé¢ä¸æ–­åˆ·æ–°ï¼Œä½†å¹¶ä¸æå€¡è¿™ä¹ˆåšï¼Œæ­£ç¡®å¯¹åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ çº¿ç¨‹ æˆ–è€… ValueAnimator æ¥æ§åˆ¶ç•Œé¢çš„åˆ·æ–°ï¼Œå…³äºæ§åˆ¶é¡µé¢åˆ·æ–°è¿™ä¸€éƒ¨åˆ†ä¼šåœ¨åç»­çš„ åŠ¨ç”»éƒ¨åˆ† è¯¦ç»†è®²è§£ï¼ŒåŒæ ·æ•¬è¯·æœŸå¾…ã€‚

å…³äº`tan`è¿™ä¸ªå‚æ•°æœ‰å¾ˆå¤šé­”æ³•å¸ˆä¸ç†è§£ï¼Œç‰¹æ­¤æ‹‰å‡ºæ¥è¯¦è¿°ä¸€ä¸‹ï¼Œ`tan` åœ¨æ•°å­¦ä¸­è¢«ç§°ä¸ºæ­£åˆ‡ï¼Œåœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œä¸€ä¸ªé”è§’çš„**æ­£åˆ‡**å®šä¹‰ä¸ºå®ƒçš„å¯¹è¾¹(Opposite side)ä¸é‚»è¾¹(Adjacent side)çš„æ¯”å€¼(æ¥è‡ªç»´åŸºç™¾ç§‘)ï¼š

![](http://ww3.sinaimg.cn/large/005Xtdi2jw1f8wyvmjf9gj307y01kdfr.jpg)

æˆ‘ä»¬æ­¤å¤„ç”¨ `tan` æ¥æè¿° Path ä¸ŠæŸä¸€ç‚¹çš„åˆ‡çº¿æ–¹å‘ï¼Œ**ä¸»è¦ç”¨äº†ä¸¤ä¸ªæ•°å€¼ tan[0] å’Œ tan[1] æ¥æè¿°è¿™ä¸ªåˆ‡çº¿çš„æ–¹å‘(åˆ‡çº¿æ–¹å‘ä¸xè½´å¤¹è§’)** ï¼Œçœ‹ä¸Šé¢å…¬å¼å¯çŸ¥ `tan` æ—¢å¯ä»¥ç”¨ `å¯¹è¾¹ï¼é‚»è¾¹` æ¥è¡¨è¿°ï¼Œä¹Ÿå¯ä»¥ç”¨ `sinï¼cos` æ¥è¡¨è¿°ï¼Œæ­¤å¤„ç”¨ä¸¤ç§ç†è§£æ–¹å¼å‡å¯ä»¥(**æ³¨æ„ä¸‹é¢ç­‰ä»·å…³ç³»**):

> **tan[0] = cos = é‚»è¾¹(å•ä½åœ†xåæ ‡)**   
> **tan[1] = sin = å¯¹è¾¹(å•ä½åœ†yåæ ‡)** 



**ä»¥ `sinï¼cos`ç†è§£:**

![](http://ww1.sinaimg.cn/large/005Xtdi2jw1f8wzrmz33tj308c0etq3c.jpg)



åœ¨åœ†ä¸Šæœ€å³ä¾§ç‚¹çš„åˆ‡çº¿æ–¹å‘å‘ä¸‹(åŠ¨å›¾ä¸­å°é£æœºæœå‘å’Œåˆ‡çº¿æœå‘ä¸€è‡´)ï¼Œåˆ‡çº¿è§’åº¦ä¸º90åº¦.  
sin90 = 1ï¼Œcos90 = 0  
tan[0] = cos = 0  
tan[1] = sin = 1



**ä»¥ `å¯¹è¾¹ï¼é‚»è¾¹` ç†è§£(å•ä½åœ†ä¸Šåæ ‡):**

æŒ‰ç…§è¿™ç§ç†è§£æ–¹å¼éœ€è¦å€ŸåŠ©ä¸€ä¸ªå•ä½åœ†ï¼Œå•ä½åœ†ä¸Šä»»æ„ä¸€ç‚¹åˆ°åœ†å¿ƒåˆ°è·ç¦»å‡ä¸º 1ï¼Œä»¥ä¸‹å›¾30åº¦ä¸ºä¾‹ï¼š  

<img src="http://ww2.sinaimg.cn/large/005Xtdi2jw1f8x0h7l7epj30k00k0juo.jpg" width="500" />

tan30 = å¯¹è¾¹ï¼é‚»è¾¹ = ABï¼OA = Bç‚¹yåæ ‡ï¼Bç‚¹xåæ ‡

> **å¦å¤–æ ¹æ®å•ä½åœ†æ€§è´¨åŒæ ·å¯ä»¥è¯å¾—:**  
> sin30 = å¯¹è¾¹ï¼æ–œè¾¹ = ABï¼OB = AB = Bç‚¹yåæ ‡ (å•ä½åœ†è¾¹ä¸Šä»»æ„ä¸€ç‚¹è·ç¦»åœ†å¿ƒè·ç¦»å‡ä¸º1ï¼Œæ•…OB = 1)  
> cos30 = é‚»è¾¹ï¼æ–œè¾¹ = OAï¼OB = OA = Bç‚¹xåæ ‡
>
> **åŒ–ä¸ºé€šç”¨å…¬å¼å³ä¸º:**  
> sin = è¯¥è§’åº¦åœ¨å•ä½åœ†ä¸Šå¯¹åº”ç‚¹çš„yåæ ‡    
> cos = è¯¥è§’åº¦åœ¨å•ä½åœ†ä¸Šå¯¹åº”ç‚¹çš„xåæ ‡
>
> å³ tan = sinï¼cos = yï¼x  
> tan[0] = x  
> tan[1] = y
>
> å¦å¤–æ³¨æ„ï¼Œè¿™ä¸ªå•ä½åœ†ä¸å°é£æœºè·¯å¾„æ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼Œä¾‹å¦‚ä¸Šä¸€ä¸ªä¾‹å­ä¸­çš„90åº¦åˆ‡çº¿ï¼Œä¸è¦åœ¨å•ä½åœ†ä¸Šæ‰¾å¯¹åº”ä½ç½®ï¼Œ**è¦æ‰¾å¯¹åº”è§’åº¦çš„ä½ç½®ï¼Œ90åº¦å¯¹åº”çš„ä½ç½®æ˜¯(0ï¼Œ1)**ï¼Œæ‰€ä»¥:  
> tan[0] = x = 0  
> tan[1] = y = 1
>
> å…¶å®ç»•æ¥ç»•å»å…¨æ˜¯ç­‰ä»·çš„  (â•¯Â°Ğ”Â°)â•¯ï¸µ â”»â”â”»

**PS: ä½¿ç”¨ Math.atan2(tan[1], tan[0]) å°† `tan` è½¬åŒ–ä¸ºè§’(å•ä½ä¸ºå¼§åº¦)çš„æ—¶å€™è¦æ³¨æ„å‚æ•°é¡ºåºã€‚**



### 6.getMatrix

è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºå¾—åˆ°è·¯å¾„ä¸ŠæŸä¸€é•¿åº¦çš„ä½ç½®ä»¥åŠè¯¥ä½ç½®çš„æ­£åˆ‡å€¼çš„çŸ©é˜µï¼š

```java
boolean getMatrix (float distance, Matrix matrix, int flags)
```

æ–¹æ³•å„ä¸ªå‚æ•°é‡Šä¹‰ï¼š

| å‚æ•°           | ä½œç”¨                  | å¤‡æ³¨                                       |
| ------------ | ------------------- | ---------------------------------------- |
| è¿”å›å€¼(boolean) | åˆ¤æ–­è·å–æ˜¯å¦æˆåŠŸ            | trueè¡¨ç¤ºæˆåŠŸï¼Œæ•°æ®ä¼šå­˜å…¥matrixä¸­ï¼Œfalse å¤±è´¥ï¼Œmatrixå†…å®¹ä¸ä¼šæ”¹å˜ |
| distance     | è·ç¦» Path èµ·ç‚¹çš„é•¿åº¦       | å–å€¼èŒƒå›´: 0 <= distance <= getLength         |
| matrix       | æ ¹æ® falgs å°è£…å¥½çš„matrix | ä¼šæ ¹æ® flags çš„è®¾ç½®è€Œå­˜å…¥ä¸åŒçš„å†…å®¹                    |
| flags        | è§„å®šå“ªäº›å†…å®¹ä¼šå­˜å…¥åˆ°matrixä¸­   | å¯é€‰æ‹©<br/>POSITION_MATRIX_FLAG(ä½ç½®) <br/>ANGENT_MATRIX_FLAG(æ­£åˆ‡) |

å…¶å®è¿™ä¸ªæ–¹æ³•å°±ç›¸å½“äºæˆ‘ä»¬åœ¨å‰ä¸€ä¸ªä¾‹å­ä¸­å°è£… `matrix` çš„è¿‡ç¨‹ç”± `getMatrix` æ›¿æˆ‘ä»¬åšäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—åˆ°ä¸€ä¸ªå°è£…å¥½åˆ° `matrix`ï¼Œå²‚ä¸å¿«å“‰ã€‚ 

ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°æœ€ååˆ° `flags` é€‰é¡¹å¯ä»¥é€‰æ‹© `ä½ç½®` æˆ–è€… `æ­£åˆ‡` ,å¦‚æœæˆ‘ä»¬ä¸¤ä¸ªé€‰é¡¹éƒ½æƒ³é€‰æ‹©æ€ä¹ˆåŠï¼Ÿ

å¦‚æœä¸¤ä¸ªé€‰é¡¹éƒ½æƒ³é€‰æ‹©ï¼Œå¯ä»¥å°†ä¸¤ä¸ªé€‰é¡¹ä¹‹é—´ç”¨ `|` è¿æ¥èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š

```
measure.getMatrix(distance, matrix, PathMeasure.TANGENT_MATRIX_FLAG | PathMeasure.POSITION_MATRIX_FLAG);
```

æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢éƒ½ä¾‹å­ä¸­ `getPosTan` æ›¿æ¢ä¸º `getMatrix`ï¼Œ çœ‹çœ‹æ˜¯ä¸æ˜¯ä¼šæ˜¾å¾—ç®€å•å¾ˆå¤š:

å…·ä½“ç»˜åˆ¶: 

```java
Path path = new Path();                                 // åˆ›å»º Path

path.addCircle(0, 0, 200, Path.Direction.CW);           // æ·»åŠ ä¸€ä¸ªåœ†å½¢

PathMeasure measure = new PathMeasure(path, false);     // åˆ›å»º PathMeasure

currentValue += 0.005;                                  // è®¡ç®—å½“å‰çš„ä½ç½®åœ¨æ€»é•¿åº¦ä¸Šçš„æ¯”ä¾‹[0,1]
if (currentValue >= 1) {
    currentValue = 0;
}

// è·å–å½“å‰ä½ç½®çš„åæ ‡ä»¥åŠè¶‹åŠ¿çš„çŸ©é˜µ
measure.getMatrix(measure.getLength() * currentValue, mMatrix, PathMeasure.TANGENT_MATRIX_FLAG | PathMeasure.POSITION_MATRIX_FLAG);

mMatrix.preTranslate(-mBitmap.getWidth() / 2, -mBitmap.getHeight() / 2);   // <-- å°†å›¾ç‰‡ç»˜åˆ¶ä¸­å¿ƒè°ƒæ•´åˆ°ä¸å½“å‰ç‚¹é‡åˆ(æ³¨æ„:æ­¤å¤„æ˜¯å‰ä¹˜pre)

canvas.drawPath(path, mDeafultPaint);                                   // ç»˜åˆ¶ Path
canvas.drawBitmap(mBitmap, mMatrix, mDeafultPaint);                     // ç»˜åˆ¶ç®­å¤´

invalidate();                                                           // é‡ç»˜é¡µé¢
```

> ç”±äºæ­¤å¤„ä»£ç è¿è¡Œç»“æœä¸ä¸Šé¢ä¸€æ ·ï¼Œä¾¿ä¸å†è´´å›¾ç‰‡äº†ï¼Œè¯·å‚ç…§ä¸Šé¢ä¸€ä¸ªç¤ºä¾‹çš„æ•ˆæœå›¾ã€‚

å¯ä»¥çœ‹åˆ°ä½¿ç”¨ getMatrix æ–¹æ³•çš„ç¡®å¯ä»¥èŠ‚çœä¸€äº›ä»£ç ï¼Œä¸è¿‡è¿™é‡Œä¾æ—§éœ€è¦æ³¨æ„ä¸€äº›å†…å®¹:

> 

- 1.å¯¹ `matrix` çš„æ“ä½œå¿…é¡»è¦åœ¨ `getMatrix` ä¹‹åè¿›è¡Œï¼Œå¦åˆ™ä¼šè¢« `getMatrix` é‡ç½®è€Œå¯¼è‡´æ— æ•ˆã€‚
- 2.çŸ©é˜µå¯¹æ—‹è½¬è§’åº¦é»˜è®¤ä¸ºå›¾ç‰‡çš„å·¦ä¸Šè§’ï¼Œæˆ‘ä»¬æ­¤å¤„éœ€è¦ä½¿ç”¨ `preTranslate` è°ƒæ•´ä¸ºå›¾ç‰‡ä¸­å¿ƒã€‚
- 3.pre(çŸ©é˜µå‰ä¹˜) ä¸ post(çŸ©é˜µåä¹˜) çš„åŒºåˆ«ï¼Œæ­¤å¤„è¯·ç­‰å¾…åç»­çš„æ–‡ç« æˆ–è€…è‡ªè¡Œæœç´¢ã€‚

------

## Path & SVG

æˆ‘ä»¬çŸ¥é“ï¼Œç”¨Pathå¯ä»¥åˆ›å»ºå‡ºå„ç§ä¸ªæ ·çš„å›¾å½¢ï¼Œä½†å¦‚æœå›¾å½¢è¿‡äºå¤æ‚æ—¶ï¼Œç”¨ä»£ç å†™å°±ä¸ç°å®äº†ï¼Œä¸ä»…éº»çƒ¦ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥åœ¨ç»˜åˆ¶å¤æ‚çš„å›¾å½¢æ—¶æˆ‘ä»¬ä¸€èˆ¬æ˜¯å°† SVG å›¾åƒè½¬æ¢ä¸º Pathã€‚

**ä½ è¯´ä»€ä¹ˆæ˜¯ SVG?**

SVG æ˜¯ä¸€ç§çŸ¢é‡å›¾ï¼Œå†…éƒ¨ç”¨çš„æ˜¯ xml æ ¼å¼åŒ–å­˜å‚¨æ–¹å¼å­˜å‚¨è¿™æ“ä½œå’Œæ•°æ®ï¼Œä½ å®Œå…¨å¯ä»¥å°† SVG çœ‹ä½œæ˜¯ Path çš„å„é¡¹æ“ä½œç®€åŒ–ä¹¦å†™åçš„å­˜å‚¨æ ¼å¼ã€‚ 

Path å’Œ SVG ç»“åˆé€šå¸¸èƒ½è¯ç”Ÿå‡ºä¸€äº›å¥‡å¦™çš„ä¸œè¥¿ï¼Œå¦‚ä¸‹:

![](http://ww3.sinaimg.cn/large/005Xtdi2jw1f4g87vfjbeg30690b4go8.gif)
![](http://ww3.sinaimg.cn/large/005Xtdi2jw1f4g89vqhqwg30690b4mzu.gif)

> **è¯¥å›¾ç‰‡æ¥è‡ªè¿™ä¸ªå¼€æºåº“ ->[PathView](https://github.com/geftimov/android-pathview)** <br/>
> **SVG è½¬ Path çš„è§£æå¯ä»¥ç”¨è¿™ä¸ªåº“ -> [AndroidSVG](https://bigbadaboom.github.io/androidsvg/)**

é™äºç¯‡å¹…ä»¥åŠæœ¬äººç²¾åŠ›ï¼Œè¿™ä¸€éƒ¨åˆ†å°±æš‚ä¸è¯¦è§£äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç›´æ¥çœ‹æºç ï¼Œæˆ–è€…æœç´¢ä¸€äº›ç›¸å…³çš„è§£ææ–‡ç« ã€‚

------

## Pathä½¿ç”¨æŠ€å·§

**è¯è¯´æœ¬ç¯‡æ–‡ç« çš„åå­—ä¸æ˜¯å« ç©å‡ºèŠ±æ ·ä¹ˆï¼Ÿæ€ä¹ˆåªè§å‰é¢å•°å•°å—¦å—¦çš„æ‰¯äº†ä¸€å¤§å †ä¸æ˜æ‰€ä»¥çš„ä¸œè¥¿ï¼ŒèŠ±æ ·åœ¨å“ªé‡Œï¼Ÿ**

> **å‰é¢çš„å†…å®¹è™½ç„¶å•°å—¦ç¹æ‚ï¼Œä½†å´æ˜¯é‡ä¸­ä¹‹é‡çš„åŸºç¡€ï¼Œå¦‚æœåœ¨ä¿®ä»™ç•Œï¼Œè¿™å«æ ¹åŸºï¼Œè€Œä¸‹é¢è®²è¿°çš„å†…å®¹çš„æ˜¯æ‹›å¼ï¼Œæœ‰äº†æ ¹åŸºæ‰èƒ½æ¼”åŒ–å‡ºåƒå˜ä¸‡åŒ–çš„æ‹›å¼ï¼Œè€Œæ²¡æœ‰æ ¹åŸºåªå­¦æ‹›å¼åˆ™æ˜¯å¾’æœ‰å…¶è¡¨ï¼Œåªèƒ½å­¦ä¸€æ ·ä¼šä¸€æ ·ï¼Œå¾ˆéš¾é€‚åº”åƒå˜ä¸‡åŒ–çš„éœ€æ±‚ã€‚**

å…ˆæ”¾ä¸€ä¸ªæ•ˆæœå›¾ï¼Œç„¶ååˆ†æä¸€ä¸‹å®ç°è¿‡ç¨‹:

![](http://ww3.sinaimg.cn/large/005Xtdi2jw1f4fp2myqo4g308c05k75k.gif)

è¿™æ˜¯ä¸€ä¸ªæœç´¢çš„åŠ¨æ•ˆå›¾ï¼Œé€šè¿‡åˆ†æå¯ä»¥å¾—åˆ°å®ƒåº”è¯¥æœ‰å››ç§çŠ¶æ€ï¼Œåˆ†åˆ«å¦‚ä¸‹:

| çŠ¶æ€   | æ¦‚è¿°                       |
| ---- | ------------------------ |
| åˆå§‹çŠ¶æ€ | åˆå§‹çŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•åŠ¨æ•ˆï¼Œåªæ˜¾ç¤ºä¸€ä¸ªæœç´¢æ ‡å¿— ğŸ” |
| å‡†å¤‡æœç´¢ | æ”¾å¤§é•œå›¾æ ‡é€æ¸å˜åŒ–ä¸ºä¸€ä¸ªç‚¹            |
| æ­£åœ¨æœç´¢ | å›´ç»•è¿™ä¸€ä¸ªåœ†ç¯è¿åŠ¨ï¼Œå¹¶ä¸”çº¿æ®µé•¿åº¦ä¼šå‘¨æœŸæ€§å˜åŒ–   |
| å‡†å¤‡ç»“æŸ | ä»ä¸€ä¸ªç‚¹é€æ¸å˜åŒ–æˆä¸ºæ”¾å¤§é•œå›¾æ ‡          |

è¿™äº›çŠ¶æ€æ˜¯æœ‰åºè½¬æ¢çš„ï¼Œè½¬æ¢æµç¨‹ä»¥åŠè½¬æ¢æ¡ä»¶å¦‚ä¸‹ï¼š

> å…¶ä¸­ `æ­£åœ¨æœç´¢` è¿™ä¸ªçŠ¶æ€æŒç»­æ—¶é—´é•¿åº¦æ˜¯ä¸ç¡®å®šçš„ï¼Œåœ¨æ²¡æœ‰æœç´¢å®Œæˆå‰ï¼Œåº”è¯¥ä¸€ç›´å¤„äºæœç´¢çŠ¶æ€ã€‚

![](http://ww4.sinaimg.cn/large/005Xtdi2jw1f4g4i3c06cj30a60gb3yt.jpg)

ç®€å•çš„åˆ†æäº†å…¶å¤§è‡´çš„æµç¨‹ä¹‹åï¼Œå°±åˆ°äº†åˆ¶ä½œçš„é‡ç‚¹:å¯¹ç»†èŠ‚å¯¹æŠŠæ¡ã€‚

### Path åˆ’åˆ†

ä¸ºäº†åˆ¶ä½œå¯¹æ–¹ä¾¿ï¼Œæ­¤å¤„æ•´ä¸ªåŠ¨æ•ˆç”¨äº†ä¸¤ä¸ª Pathï¼Œ ä¸€ä¸ªæ˜¯ä¸­é—´å¯¹æ”¾å¤§é•œï¼Œ å¦ä¸€ä¸ªåˆ™æ˜¯å¤–ä¾§çš„åœ†ç¯,å°†ä¸¤è€…å…¨éƒ¨ç”»å‡ºæ¥æ˜¯è¿™æ ·å­çš„ã€‚

![](http://ww4.sinaimg.cn/large/005Xtdi2jw1f4gbhxuuktj308c0etwej.jpg) 

å…¶ä¸­ Path çš„èµ°å‘è¦æŠŠæ¡å¥½ï¼Œå¦‚ä¸‹(åªæ˜¯ä¸€ä¸ªæ”¾å¤§é•œï¼Œå¹¶ä¸æ˜¯â™‚):

![](http://ww1.sinaimg.cn/large/005Xtdi2jw1f4gbjj3fd1j308c05kt8i.jpg)

å…¶ä¸­åœ†å½¢ä¸Šé¢çš„ç‚¹å¯ä»¥ç”¨ PathMeasure æµ‹é‡ï¼Œæ— éœ€è®¡ç®—ã€‚

### åŠ¨ç”»çŠ¶æ€ä¸æ—¶é—´å…³è”

æ­¤å¤„ä½¿ç”¨çš„æ˜¯ ValueAnimatorï¼Œå®ƒå¯ä»¥å°†ä¸€æ®µæ—¶é—´æ˜ å°„åˆ°ä¸€æ®µæ•°å€¼ä¸Šï¼Œéšç€æ—¶é—´å˜åŒ–ä¸æ–­çš„æ›´æ–°æ•°å€¼ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ’å€¼å™¨å¼€æ§åˆ¶æ•°å€¼å˜åŒ–è§„å¾‹(æ­¤å¤„ä½¿ç”¨çš„æ˜¯é»˜è®¤æ’å€¼å™¨)ã€‚

> PS: æœ¬æ¥ä¸æƒ³æå‰æš´éœ²è¿™ä¸ªçš„ï¼Œå‡†å¤‡å·å·ç•™åˆ°åŠ¨ç”»éƒ¨åˆ†(ï½¡-_-ï½¡) ä½†å®åœ¨æ˜¯æ²¡æœ‰ä¼˜é›…çš„æ›¿ä»£æ–¹æ¡ˆäº†ã€‚

### å…·ä½“ç»˜åˆ¶

ç»˜åˆ¶éƒ¨åˆ†æ˜¯æ ¹æ® å½“å‰çŠ¶æ€ä»¥åŠä» ValueAnimator è·å¾—çš„æ•°å€¼æ¥æˆªå– Path ä¸­åˆé€‚çš„éƒ¨åˆ†ç»˜åˆ¶å‡ºæ¥ã€‚

### æœ€ç»ˆæ•ˆæœ

![](http://ww3.sinaimg.cn/large/005Xtdi2jw1f4gbmtj0mvg308c0etq58.gif)

### æºç 

ä¸Šé¢çš„å†…å®¹æ˜¯ä¸ºäº†å¸®åŠ©å¤§å®¶ä»æŠŠæ§å…¨å±€æµç¨‹ä»¥åŠç†è§£æŸäº›ç»†èŠ‚çš„è®¾è®¡æ€è·¯ï¼Œè€Œæ›´å¤šçš„å†…å®¹éƒ½è—åœ¨ä»£ç ä¸­ï¼Œä»£ç æ€»ä½“ä¹Ÿä¸ç®—é•¿ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±æ•²ä¸€éã€‚

#### [æˆ³è¿™é‡ŒæŸ¥çœ‹æºç ](https://github.com/GcsSloop/AndroidNote/blob/master/CustomView/Advance/Code/SearchView.md)

> PS: æœ¬ä»£ç ä»…ä½œä¸ºç¤ºä¾‹ä½¿ç”¨ï¼Œè¿˜æœ‰è¯¸å¤šä¸è¶³ï¼Œå¦‚ è‡ªå®šä¹‰å±æ€§ï¼Œè§†å›¾å¤§å°ï¼Œ ç‚¹å‡»äº‹ä»¶ï¼Œ ç›‘å¬å›è°ƒ ç­‰ï¼Œå¹¶ä¸é€‚åˆç›´æ¥ä½¿ç”¨ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è‡ªè¡Œè¡¥è¶³ç›¸å…³å†…å®¹ã€‚

## æ€»ç»“

**æœ¬æ–‡ä¸­è™½ç„¶åé¢çš„å†…å®¹çœ‹èµ·æ¥æ¯”è¾ƒé«˜å¤§ä¸Šä¸€ç‚¹ï¼Œä½†å‰é¢"å•°å—¦"çš„åºŸè¯æ‰æ˜¯çœŸæ­£çš„å¹²è´§ï¼ŒæŠŠå‰é¢çš„ä¸œè¥¿å­¦ä¼šäº†ï¼Œåé¢çš„å„ç§æ•ˆæœéƒ½èƒ½ä¿¡æ‰‹æ‹ˆæ¥ï¼Œå¦‚æœåªç ”ç©¶åé¢çš„ä¸œè¥¿ï¼Œåˆ™æ˜¯å–å…¶å½¢ï¼Œè€Œéš¾ä»¥ä¼šå…¶æ„ã€‚**

#### PS: ç”±äºæœ¬äººæ°´å¹³æœ‰é™ï¼ŒæŸäº›åœ°æ–¹å¯èƒ½å­˜åœ¨è¯¯è§£æˆ–ä¸å‡†ç¡®ï¼Œå¦‚æœä½ å¯¹æ­¤æœ‰ç–‘é—®å¯ä»¥æäº¤Issuesè¿›è¡Œåé¦ˆã€‚

## About

[æœ¬ç³»åˆ—ç›¸å…³æ–‡ç« ](http://www.gcssloop.com/customview/CustomViewIndex/)

ä½œè€…å¾®åš: [GcsSloop](http://weibo.com/GcsSloop)

## å‚è€ƒèµ„æ–™

[PathMeasure](https://developer.android.com/reference/android/graphics/PathMeasure.html)<br/>
[AndroidSVG](https://bigbadaboom.github.io/androidsvg/)<br/>
[android-pathview](https://github.com/geftimov/android-pathview)<br/>
[android Path å’Œ PathMeasure è¿›é˜¶](http://blog.csdn.net/cquwentao/article/details/51436852)<br/>

